# Chapter 10. 람다를 이용한 도메인 전용 언어
> Keyword : DSL, 내부 DSL, 외부 DSL, 다중 DSL, 

- DSL을 API에 추가할 때의 장단점
- JVM에서 활용할 수 있는 자바 기반 DSL을 깔끔하게 만드는 대안
- 최신 자바 인터페이스와 클래스에 적용된 DSL에서 배움
- 효과적인 자바 기반 DSL을 구현하는 패턴과 기법
- 이들 패턴을 자바 라이브러리와 도구에서 얼마나 흔히 사용하는가

## 10.1 도메인 전용 언어
### DSL
- 특정 비즈니스 도메인의 문제를 해결하려고 만든 언어
- 특정 비즈니스 도메인을 인터페이스로 만든 API
- 작은, 범용이 아니라 특정 도메인을 대상으로 만들어진 특수 프로그래밍 언어
- 비즈니스 로직을 간편하게 캡슐화
- ex. Maven, Ant : 빌드 과정을 표현하는 DSL

### 장점과 단점
- 장점 : 간결함 / 가독성  / 유지보수 / 높은 수준의 추상화 / 집중 / 관심사분리
- 단점 : DSL 설계의 어려움 / 개발 비용 / 추가 우회 계층 / 새로 배워야 하는 언어 / 호스팅 언어 한계

### JVM에서 이용할 수 있는 다른 DSL 해결책
#### 내부 DSL (임베디드 DSL, internal DSL)
- 순수 자바 코드 같은 기존 호스팅 언어를 기반으로 구현
- 람다 표현식, 메서드 참조 활용
- 다른 언어의 컴파일러나 외부 DSL을 만드는 도구 사용 필요 없음 -> 추가비용 x

#### 외부 DSL (external DSL)
- 호스팅 언어와는 독립적으로 자체의 문법
- 무한한 유연성
- 새 언어를 파싱하고, 파서의 결과를 분석하고, 외부 DSL을 실행할 코드를 만들어야 한다

#### 다중 DSL 
- 같은 자바 바이트코드를 사용하는 JVM 기반 프로그래밍 언어를 이용함으로 DSL 합침 문제를 해결
- 스칼라, 루비, 코틀린, 실론, JRuby, Jython : JVM에서 실행되는 언어
- 두 개 이상의 언어가 혼재하므로 여러 컴파일러로 소스를 빌드하도록 빌드 과정을 개선해야 함
- 완벽 호환은 아님 (ex. 스칼라와 자바 컬렉션은 서로 호환되지 않음)

## 10.2 최신 자바 API의 작은 DSL
### 10.2.1 스트림  API는 컬렉션을 조작하는 DSL
- Stream은 컬렉션의 항목을 필터, 정렬, 변환, 그룹화, 조작하는 작지만 강력한 DSL로 볼 수 있다
- 스트림 API의 플루언트 형식은 잘 설계된 DSL 특징. 
- 모든 중간 연산은 게으르며 다른 연산으로 파이프라인될 수 있는 스트림으로 반환
- 최종 연산은 적극적이며 전체 파이프라인이 계산 일으킴

### 10.2.2 데이터를 수집하는 DSL인 Collectors
- Collector 인터페이스는 데이터 수집을 수행하는 DSL

## 10.3 자바로 DSL을 만드는 패턴과 기법
### 10.3.1 메서드 체인
- 한 개의 메서드 호출 체인으로 거래 주문 정의
- 플루언트 방식
- 주문에 사용한 파라미터가 빌더 내부로 국한되는 등 장점 있지만 빌더를 구현해야 한다
- 상위 수준의 빌더를 하위 수준의 빌더와 연결할 접착 많은 접착 코드가 필요
### 10.3.2 중첩된 함수  이용
- 다른 함수 안에 함수를 이용해 도메인 모델 만듦
- 인수 목록을 정적 메서드에 넘겨줘야 한다. 괄호 많아서 복잡
### 10.3.3 람다 표현식을 이용한 함수 시퀀싱
- 람다 표현식으로 정의한 함수 시퀀스 사용
- 메서드 체인 과 중첩된 함수 DSL 형식의 장점을 더함. 
- 메서드 체인 패턴처럼 플루언트 방식으로 거래 주문을 정의 & 중첩 함수 형식처럼 다양한 람다 표현식의 중첩 수준과 비슷하게 도메인 객체의 계층 구조를 유지
- 단 : 설정 코드 과다 &  DSL 자체가 자바 8 람다 표현식 문법에 의한 잡음의 영향 받음
### 10.3.4 조합하기
- 메서드 체인 / 중첩된 함수 / 람다 3가지를 자유롭게 조합

### 10.3.5 DSL에 메서드 참조 사용하기
일반 메서드 -> 메서드 체인 / 중첩된 함수 / 람다 표현식 -> 메서드 참조

