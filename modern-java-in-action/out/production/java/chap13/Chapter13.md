# Chapter 13. 디폴트 메서드
> Keyword : 디폴트 메서드

## 13.1 변화하는 API
#### 인터페이스
인터페이스를 구현하는 클래스는 인터페이스에서 정의하는 모든 메서드 구현을 제공하거나 슈퍼클래스의 구현을 상속받아야 한다.

#### 자바8의 기본 구현 포함 인터페이스 정의 방법
1. 인터페이스 내부에 정적 메서드 사용
2. 디폴트 메서드 기능 사용 : 인터페이스 기본 구현 제공. 메서드 구현을 포함하는 인터페이스 제공.

### 디폴트 메서드 (default)
- 인터페이스의 기본 구현을 그대로 상속하므로 인터페이스에 자유롭게 새로운 메서드 추가 가능
- 공개된 API를 고치면 기존 버전과의 호환성 문제가 발생 --> 디폴트 메서드를 사용
- 라이브러리를 바꿔도 호환성을 유지할 수 있음
```java
default void sort(Comparator<? super E> c) {
    Collections.sort(this,c);
}

default Stream<E> stream() {
    return StreamSupport.stream(spliterator(), false);
}
// stream 메서드는 내부적으로 StreamSupport.stream 메서드를 호출해서 스트림 반환
```

### 호환성 문제 3가지 (바이너리, 소스, 동작)
- 바이너리 호환성 : 바꾼 이후에도 에러 없이 기존 바이너리가 실행될 수 있는 상황
- 소스 호환성 : 코드를 고쳐도 기존 프로그램을 성공적으로 재컴파일할 수 있는 상황
- 동작 호환성 : 코드를 바꾼 다음에도 같은 입력값이 주어지면 프로그램이 같은 동작 실행

## 13.2 디폴트 메서드란 무엇인가?
### 추상 클래스 vs. 인터페이스
- 같은점 : 둘 다 추상 메서드와 바디를 포함하는 메서드를 정의할 수 있다.
- 차이점 1 : 클래스는 하나의 추상 클래스만 상속받을 수 잇지만 인터페이스를 여러 개 구현 가능
- 차이점 2 : 추상 클래스는 인스턴스 변수(필드)로 공통 상태를 가질 수 있다. 인터페이스는 인스턴스 변수를 가질 수 없다.

## 13.3 디폴트 메서드 활용 패턴
디폴트 메서드를 이용하는 두 가지 방식 (선택형 메서드 / 동작 다중 상속)
### 13.3.1 선택형 메서드
디폴트 메서드를 이용하면 기본 구현을 제공할 수 있으므로 인터페이스를 구현하는 클래스에서 빈 구현을 제공할 필요가 없다
```java
interface Iterator<T> { 
    boolean hasNext();
    T next();
    default void remove() {
        throw new UnsupportedOperationException();
    }
}
```
### 13.3.2 동작 다중 상속
- 클래스는 한 개의 다른 클래스만 상속할 수 있지만 인터페이스는 여러 개 구현 가능
- 클래스는 다중 상속을 이용해서 기존 코드 재사용 가능
#### 다중 상속 형식
- 디폴트 메서드를 사용하지 않아도 다중 상속 활용 가능
- 인터페이스가 구현을 포함할 수 있으므로 클래스는 여러 인터페이스에서 동작(구현 코드)을 상속받을 수 있다
#### 기능이 중복되지 않는 최소의 인터페이스
#### 인터페이스 조합
- 인터페이스를 조합해서 다양한 클래스 구현

## 13.4 해석 규칙
같은 시그니처를 갖는 디폴트 메서드를 상속받는 상황 발생 가능
### 13.4.1 알아야 할 세 가지 해결 규칙 (같은 시그니처를 갖는 메서드를 상속받을 때)
1. 클래스가 항상 이긴다. 클래스나 슈퍼클래스에서 정의한 메서드가 디폴트 메서드보다 우선권을 갖는다
2. 1번 규칙 이외의 상황에서는 서브인터페이스가 이긴다. 상속관계를 갖는 인터페이스에서 같은 시그니처를 갖는 메서드를 정의할 때는 서브인터페이스가 이긴다. 즉, B가 A를 상속받는다면 B가 A를 이긴다.
3. 여전히 디폴트 메서드의 우선순위가 결정되지 않았다면 여러 인터페이스를 상속받는 클래스가 명시적으로 디폴트 메서드를 오버라이드하고 호출해야 한다

### 13.4.2 디폴트 메서드를 제공하는 서브인터페이스가 이긴다
### 13.4.3 충돌 그리고 명시적인 문제 해결
#### X.super.m(...)
- X는 호출하려는 메서드 m의 슈퍼인터페이스
- 개발자가 직접 클래스에서 사용하려는 메서드를 명시적으로 선택
```java
public class C implements B, A {
    void hello() {
        B.super.hello();
    }
}
```

## 13.5 마치며
- 자바 8의 인터페이스는 구현 코드를 포함하는 디폴트 메서드, 정적 메서드를 정의할 수 있다.
- 디폴트 메서드의 정의는 default 키워드로 시작하며 일반 클래스 메서드처럼 바디를 갖는다.
- 공개된 인터페이스에 추상 메서드를 추가하면 소스 호환성이 깨진다.
- 디폴트 메서드 덕분에 라이브러리 설계자가 API를 바꿔도 기존 버전과 호환성을 유지할 수 있다.
- 선택형 메서드와 동작 다중 상속에도 디폴트 메서드를 사용할 수 있다.
- 클래스가 같은 시그니처를 갖는 여러 디폴트 메서드를 상속하면서 생기는 충돌 문제를 해결하는 규칙이 있다.
- 두 메서드의 시그니처가 같고, 상속관계로도 충돌 문제를 해결할 수 없을 때는 디폴트 메서드를 사용하는 클래스에서 메서드를 오버라이드해서 어떤 디폴트 메서드를 호출할지 명시적으로 결정해야 한다