# Chapter 18. 함수형 관점으로 생각하기
> Keyword : 함수형 프로그래밍, 선언형 프로그래밍, 불변성, 부작용 없음, 참조 투명성, 반복과 재귀, 꼬리 재귀

## 18.1 시스템 구현과 유지보수
자바 8의 스트림을 이용하면 잠금 문제를 신경 쓰지 않을 수 있지만 상태없는 동작이어야 한다.  
스트림 처리 파이프라인의 함수는 다른 누군가가 변수의 값을 바꿀 수 있는 상태에 있는 변수를 사용하지 않는다
### 18.1.1 공유된 가변 데이터
#### 공유된 가변 데이터
변수가 예상하지 못한 값을 갖는 이유는 결국 우리가 유지보수하는 시스템의 여러 메서드에서 공유된 가변 데이터 구조를 읽고 갱신하기 때문
#### 순수 메서드 (부작용 없는 메서드)
자신을 포함하는 클래스의 상태 그리고 다른 객체의 상태를 바꾸지 않으며 return 문을 통해서만 자신의 결과를 반환하는 메서드
#### 부작용
- 함수 내에 포함되지 못한 기능
- 불변 객체를 이용해서 부작용을 없애는 방법도 있다
- 자료구조를 고치거나 필드에 값을 할당(setter 메서드 같은 생성자 이외의 초기화 동작)
- 예외 발생
- 파일에 쓰기 등의 I/O 동작 수행

### 18.1.2 선언형 프로그래밍
#### 명령형 프로그래밍
- '어떻게(how)'에 집중하는 프로그래밍 형식
- 할당, 조건문, 분기문, 루프 등 명령어가 컴퓨터의 저수준 언어와 비슷하게 생김
#### 선언형 프로그래밍
- '무엇을'에 집중하는 프로그래밍 방식
- 우리가 원하는 것이 무엇이고 시스템이 어떻게 그 목표를 달성할 것인지 등의 규칙을 정한다
- 강점 : 문제 자체가 코드로 명확하게 드러난다

### 18.1.3 왜 함수형 프로그래밍인가?

## 18.2 함수형 프로그래밍이란 무엇인가?
#### 함수
- 수학적인 함수와 같다
- 0개 이상의 인수를 가지며, 한 개 이상의 결과를 반환하지만 부작용이 없어야 한다
- 여러 입력을 받아서 여러 출력을 생성하는 블랙박스와 같다
#### 함수형
'수학의 함수처럼 부작용이 없는'을 의미
#### 순수 함수형 프로그래밍
'함수 그리고 if-then-else 등의 수학적 표현만 사용'하는 방식
#### 함수형 프로그래밍
'시스템의 다른 부분에 영향을 미치지 않는다면 내부적으로는 함수형이 아닌 기능도 사용'하는 방식

### 18.2.1 함수형 자바
- 자바로는 순수 함수형 프로그래밍 구현은 어려움
- 실제 부작용이 있지만 아무도 이를 보지 못하게 함으로 함수형 프로그램을 구현
- *객체의 모든 필드가 final이어야 하고 모든 참조 필드는 불변 객체를 직접 참조해야 한다*
- *함수나 메서드가 어떤 예외도 일으키지 않아야 한다*
- 비함수형 동작을 감출 수 있는 상황에서만 부작용을 포함하는 라이브러리 함수를 사용해야 한다
### 18.2.2 참조 투명성
같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환한다면 참조적으로 투명한 함수
### 18.2.3 객체지향 프로그래밍과 함수형 프로그래밍
#### 함수형 프로그래밍 vs. 기존의 익스트림 객체지향 프로그래밍
- 자바8은 함수형 프로그래밍을 익스트림 객체지향 프로그래밍의 일종으로 간주
- 익스트림 객체지향 방식: 모든 것을 객체로 간주하고 프로그램이 객체의 필드를 갱신하고, 메서드를 호출하고, 관련 객체를 갱신하는 방식으로 동작
- 함수형 프로그래밍 형식: 참조적 투명성을 중시하는, 즉 변화를 허용하지 않음
- 자바 프로그래머는 두 프로그래밍 방식 혼합
### 18.2.4 함수형 실전 연습

## 18.3 재귀와 반복
- 순수 함수형 프로그래밍 언어에서는 while, for 같은 반복문을 포함하지 않는다
- 이론적으로 반복을 이용하는 모든 프로그램은 재귀로도 구현할 수 있는데 재귀를 이용하면 변화가 일어나지 않는다
- 재귀를 이용하면 루프 단계마다 갱신되는 반복 변수를 제거할 수 있다
- 자바 8에서는 반복을 스트림으로 대체해서 변화를 피할 수 있다. 또한 반복을 재귀로 바꾸면 더 간결하고, 부작용이 없는 알고리즘을 만들 수 있다
#### 꼬리 호출 최적화
- 꼬리 재귀 : 재귀 호출이 가장 마지막에서 이루어짐
- 일반 재귀 방식은 입력값에 비례해서 메모리 사용량 증가. StackOverflowError 위험
- 일반 재귀는 중간 결과를 각각의 스택 프레임으로 저장해야 한다 
- 꼬리 재귀에서는 컴파일러가 하나의 스택 프레임을 재활용할 가능성이 생긴다
- 자바는 사실 이런 최적화를 제공하지 않지만 컴파일러 최적화 여지가 있는 꼬리 재귀를 적용하는 게 좋다 

## 18.4 마치며
- 공유된 가변 자료구조를 줄이는 것은 장기적으로 프로그램을 유지보수하고 디버깅하는 데 도움이 된다.
- 함수형 프로그래밍은 부작용이 없는 메서드와 선언형 프로그래밍 방식을 지향한다.
- 함수형 메서드는 입력 인수와 출력 결과만을 갖는다.
- 같은 인수값으로 함수를 호출했을 때 항상 같은 값을 반환하면 참조 투명성을 갖는 함수다. while 루프 같은 반복문은 재귀로 대체할 수 있다.
- 자바에서는 고전 방식의 재귀보다는 꼬리 재귀를 사용해야 추가적인 컴파일러 최적화를 기대할 수 있다