# Chapter 17. 리액티브 프로그래밍
> Keyword : 리액티브 프로그래밍, 리액티브 매니패스토, 리액티브 스트림, 플로 API, RxJava, 마블 다이어그램

## 17.1 리액티브 매니패스토
#### 리액티브 매니패스토
- 리액티브 애플리케이션과 시스템 개발의 핵심 원칙을 공식적으로 정의
1. 반응성 : 시스템은 가능한한 적정 시간 안에 반응한다. 반응성이 뒷받침되어야 사용성을 높일 수 있다
2. 회복성 : 장애 시에도 시스템의 반응성은 유지된다
3. 탄력성 : 다양한 작업 부하에도 시스템 반응성이 유지된다. 입력 속도가 바뀐다면 이들 입력 관련 서비스에 할당된 자원을 늘리거나 줄임으로 반응할 수 있다. 
4. 메시지 주도 : 컴포넌트 간의 약산 결합, 고립, 위치 투명성이 유지되도록 시스템은 비동기 메시지 전달에 의존한다
### 17.1.1 애플리케이션 수준의 리액티브
- 주요기능 : 비동기로 작업을 수행할 수 있다
- 리액티브 프레임워크와 라이브러리는 스레드를 퓨처, 액터, 일련의 콜백을 발생시키는 이벤트 루프 등과 공유하고 처리할 이벤트를 변환하고 관리
- 저 수준의 멀티스레드 문제를 직접 처리할 필요가 없어짐 (동기 블록, 데드락, 경쟁 조건 등)
- 리액티브 시스템을 만들려면 훌륭하게 설계된 리액티브 애플리케이션 집합이 서로 잘 조화를 이루게

### 17.1.2 시스템 수준의 리액티브
#### 리액티브 시스템
- 주요 속성 : 메시지 주도
- 여러 애플리케이션이 한 개의 일관적인, 회복할 수 있는 플랫폼을 구성할 수 있게 해주고 이들 애플리케이션 중 하나가 실패해도 전체 시스템은 계속 운영될 수 있도록 도와주는 소프트웨어 아키텍처
- 메시지는 정의된 하나의 목적지를 향함 / 이벤트를 관련 이벤트를 관찰하도록 등록한 컴포넌트가 수신
- 수신자와 발신자가 각각 수신 메시지, 발신 메시지와 결합하지 않도록 이들 메시지를 비동기로 처리
- 컴포넌트에서 발생한 장애를 고립시킴으로 문제가 주변의 다른 컴포넌트로 전파되면서 전체 시스템 장애로 이어지는 것을 막음으로 회복성을 제공
#### 리액티브 애플리케이션 vs. 리액티브 시스템
- 리액티브 애플리케이션 : 비교적 짧은 시간 동안만 유지되는 데이터 스트림에 기반한 연산을 수행하며 보통 이벤트 주도로 분류
- 리액티브 시스템 : 애플리케이션을 조립하고 상호소통을 조절

## 17.2 리액티브 스트림과 플로 API
#### 리액티브 프로그래밍
리액티브 스트림을 사용하는 프로그래밍
#### 리액티브 스트림
잠재적으로 무한의 비동기 데이터를 순서대로 그리고 블록하지 않는 역압력을 전제해 처리하는 표준 기술
#### 역압력
- 발행-구독 프로토콜에서 이벤트 스트림의 구독자가 발행자가 이벤트를 제공하는 속도보다 느린 속도로 이벤트를 소비하면서 문제가 발생하지 않도록 보장하는 장치
- 스트림 처리의 비동기적인 특성상 역압력 기능의 내장은 필수
- Publisher가 너무 빠른 속도로 데이터를 발행하면서 Subscriber가 이를 감당할 수 없는 상황에 이르는 것을 방지하는 기능

### 17.2.1 Flow 클래스 소개
- java.util.concurrent.Flow
- 리액티브 프로그래밍을 제공하는 클래스
- 이 클래스는 정적 컴포넌트 하나를 포함하고 있으며 인스턴스화할 수 없다
- 프로그래밍 발행-구독 모델을 지원할 수 있도록 중첩된 인터페이스 네 개를 포함
#### Publisher / Subscriber / Subscription / Processor
- Publisher :  subscribe() / 항목을 발행. 자바의 함수형 인터페이스.
- Subscriber : onSubscribe(), onNext(), onError(), onComplete() / 한 개씩 또는 한 번에 여러 항목을 소비. Publisher가 발행한 이벤트의 리스너로 자신 등록 가능.
- Subscription : request(), cancel() / Publisher와 Subscriber 사이의 제어 흐름, 역압력을 관리
- Processor 인터페이스는 단지 Publisher와 Subscriber를 상속받을 뿐 아무 메서드도 추가하지 않는다
- Publisher는 수많은 일련의 이벤트를 제공할 수 있지만 Subscriber의 요구사항에 따라 역압력 기법에 의해 이벤트 제공 속도가 제한

### 17.2.2 첫번째 리액티브 애플리케이션 만들기
1. 간단한 도메인 모델 정의
2. Subscription : Subscriber가 요청할 때마다 해당 도시의 온도를 전송하도록 Subscription을 구현
3. Subscriber : 새 요소 얻을 때마다 Subscription이 전달한 온도를 출력하고 새 레포트를 요청하는 Subscriber 클래스 구현
4. Publisher : 리액티브 애플리케이션이 실제 동작할 수 있도록 Publisher를 만들고 TempSubscriber를 이용해 Publisher에 구독하도록 Main 클래스를 구현
### 17.2.3 Processor로 데이터 변환하기
- Processor는 Subscriber이며 동시에 Publisher
- Processor의 목적은 Publisher를 구독한 다음 수신한 데이터를 가공해 다시 제공하는 것

### 17.2.4 자바는 왜 플로 API 구현을 제공하지 않는가?
- 플로 API는 구현을 제공하지 않으므로 우리가 직접 인터페이스를 구현
- API를 만들 당시 Akka, RxJava 등 다양한 리액티브 스트림의 자바 코드 라이브러리가 이미 존재
- 서로 다른 이름규칙과 API를 사용했는데, 자바9 표준화과정에서 java.util.concurrent.Flow의 인터페이스를 기반으로 리액티브 개념을 구현하도록 진화

## 17.3 리액티브 라이브러리 RxJava 사용하기
#### RxJava
- 자바로 리액티브 애플리케이션을 구현하는 데 사용하는 라이브러리
- Reactive Streams API와 java.util.concurrent.Flow를 지원하도록 RxJava 2.0 버전
- 천 개 이하의 요소를 가진 스트림이나 마우스 움직임, 터치 이벤트 등 역압력을 적용하기 힘든 GUI 이벤트와 자주 발생하지 않는 종류의 이벤트에 역압력을 적용하지 말 것을 권장
- RxJava는 Flow.Publisher를 구현하는 두 클래스를 제공
  - io.reactivex.Flowable 클래스 : 리액티브 당김 기반 역압력 기능(request 메서드)이 있는 Flow를 포함
  - Publisher io.reactivex.Observable 클래스 : 역압력 지원하지 않는 기존 버전의 RxJava에서 제공하던 클래스. 단순한 프로그램, 마우스 움직임 같은 사용자 인터페이스 이벤트에 더 적합
### 17.3.1 Observable 만들고 사용하기
- 다양한 종류의 리액티브 스트림을 편리하게 만들 수 있도록 여러 팩토리 메서드를 제공
- RxJava에서 Observable이 플로 API의 Publisher 역할, Observer는 Flow의 Subscriber 인터페이스 역할
- 역압력 지원하지 않음
- RxJava Observer인터페이스는 Subscriber와 같은 메서드를 정의. onSubscribe 메서드가 Subscription 대신 Disposable 인수를 갖는다는 점만 다르다
- 역압력을 지원하지 않으므로 Subscription의 request 메서드를 포함하지 않는다
- 모든 구독자는 구독 객체의 request(Long.MAX_VALUE) 메서드를 이용해 역압력 기능을 끌 수 있다
#### just()
- 한 개 이상의 요소를 이용해 이를 방출하는 Observable로 변환
- Observable의 구독자는 onNext("first"), onNext("second"), onComplete()의 순서로 메시지를 받는다
#### interval()
- 사용자와 실시간으로 상호작용하면서 지정된 속도로 이벤트를 방출하는 상황에서 유용
- 0에서 시작해 1초 간격으로 long 형식의 값을 무한으로 증가시키며 값을 방출하는 등에 활용
#### ObservableEmitter 인터페이스
- RxJava의 기본 Emitter(onSubscribe 메서드가 빠진 Observer와 같음)를 상속
- Emitter는 새 Disposable을 설정하는 메서드와 시퀀스가 이미 다운스트림을 폐기했는지 확인하는 메서드 등을 제공
### 17.3.2 Observable을 변환하고 합치기
- RxJava나 기타 리액티브 라이브러리는 자바 9 플로 API에 비해 스트림을 합치고, 만들고, 거르는 등의 풍부한 도구상자를 제공하는 것이 장점
#### 마블 다이어그램
- 수평선으로 표시된 리액티브 스트림에 임의의 순서로 구성된 요소가 기하학적 모형이 나타난다
- 특수 기호는 에러나 완료 신호를 나타낸다
- 박스는 해당 연산이 요소를 어떻게 변화하거나 여러 스트림을 어떻게 합치는지 보여준다

## 17.4 마치며
- 리액티브 프로그래밍의 기초 사상은 이미 20에서 30년 전에 수립되었지만 데이터 처리량과 사용자 기대치 덕분에 최근에서야 인기를 얻고 있다.
- 리액티브 소프트웨어가 지녀야 할 네 가지 관련 특징(반응성, 회복성, 탄력성, 메시지 주도)을 서술하는 리액티브 매니페스토가 리액티브 프로그래밍 사상을 공식화한다.
- 여러 애플리케이션을 통합하는 리액티브 시스템과 한 개의 애플리케이션을 구현할 때에 각각 다른 접근 방식으로 리액티브 프로그래밍 원칙을 적용할 수 있다.
- 리액티브 애플리케이션은 리액티브 스트림이 전달하는 한 개 이상의 이벤트를 비동기로 처리함을 기본으로 전제한다. 리액티브 애플리케이션 개발에서 리액티브 스트림의 역할이 핵심적이므로 넷플릭스, 피보탈, 라이트벤드, 레드햇 등은 다양한 구현의 상호운용성을 극대화할 수 있도록 컨소시엄을 구성해 개념을 표준화한다.
- 리액티브 스트림은 비동기적으로 처리되므로 역압력 기법이 기본적으로 탑재되어 있다. 역압력은 발행자가 구독자보다 빠른 속도로 아이템을 발행하므로 발생하는 문제를 방지한다
- 설계와 표준화 절차 결과가 자바에 반영되었다. 자바 9 플로 API는 Publisher, Subscriber, Subscription, Processor 네 개의 핵심 인터페이스를 정의한다.
- 대부분의 상황에서는 이들 인터페이스를 직접 구현할 필요가 없으며 실제 이들 인터페이스는 리액티브 패러다임을 구현하는 다양한 라이브러리의 공용어 역할을 한다.
- 가장 흔한 리액티브 프로그래밍 도구로 RxJava를 꼽을 수 있으며 이 라이브러리는 자바9 플로 API의 기본 기능에 더해 다양한 강력한 연산자를 제공한다. 예를 들어 한 스트림에서 방출한 요소를 변환하거나, 거를 수 있으며 여러 스트림의 데이터를 일부 합치거나 전체를 모을 수 있다.

